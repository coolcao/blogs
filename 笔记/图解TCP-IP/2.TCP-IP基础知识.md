---
title: 2.TCP-IP基础知识.md
date: 2021-08-02 17:14:18
tags: []
categories:
- 技术博客
- 原创
---

![](https://img-vnote-1251075307.cos.ap-beijing.myqcloud.com/1627898612_20210802171444537_298826773.png)

## TCP/IP标准化
### TCP/IP的具体含义
TCP/IP 是指利用IP进行通信时所必须用到的协议群的统称。
![](https://img-vnote-1251075307.cos.ap-beijing.myqcloud.com/1627898613_20210802171755253_1564807125.png)

## 互联网
互联网中的每个网络都是由骨干网和末端网组成的。每个网络之间通过NOC（Network Operation Center）相连。

## TCP/IP协议分层模型
### TCP/IP与OSI参考模型
![](https://img-vnote-1251075307.cos.ap-beijing.myqcloud.com/1627898613_20210802172054334_1628608713.png)

### 硬件（物理层）
最底层是负责传输的硬件。这种硬件就相当于以太网或电话线路等物理层的设备。

### 网络接口层（数据链路层）
网络接口层利用以太网中的数据链路层进行通信，因此属于接口层。也就是说把它当作NIC起作用的”驱动程序“也无妨。

### 互联网层（网络层）
互联网层使用IP协议，它相当于OSI模型中的第3层网络层。IP协议基于IP地址转发数据包。

TCP/IP分层中的互联网层和传输层的功能通常由操作系统提供。尤其是路由器，它必须得实现通过互联网层转发数据包的功能。


- IP：IP是跨越网络传送数据包，使整个互联网都能收到数据的协议。IP协议能使数据发送到地球另一端，它使用IP地址作为主机的标识。虽然IP也是分组交换的一种协议，但它不具有重发机制，即使分组数据包未能到达对端主机也不会重发。因此属于非可靠性传输。
- ICMP：IP数据包在发送途中一旦发生异常无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。ICMP就是为这一功能而定制的。它有时也被用来诊断网络的健康状况。
- ARP：从分组数据包的IP地址中解析出物理地址（MAC地址）的一种协议

### 传输层
- TCP：TCP是一种面向有连接的传输协议。它可以保证两端通信主机之间的通信可达。TCP能够正确处理在传输过程中丢包，传输顺序乱掉等异常情况。此外，TCP还能有效的利用带宽，缓解网络拥堵。
- UDP： UDP是一种面向无连接的传输协议。UDP不会关注对端是否收到了传送过去的数据，如果需要检查对端是否接收到数据，或者对端是否连接到网络，则需要在应用程序中实现。UDP通常用于分组数据较少，或多播，广播通信以及视频通信等多媒体领域。

### 应用层（会话层以上的分层）
TCP/IP 的分层中，将OSI参考模型中的会话层，表示层和应用层的功能都集中到了应用程序中实现。

- www
- 电子邮件（E-mail）
- 文件传输（FTP）
- 远程登录（TELNET与SSH）
- 网络管理（SNMP）

## TCP/IP分层模型与通信示例
### 数据包首部
![](https://img-vnote-1251075307.cos.ap-beijing.myqcloud.com/1627898614_20210802173948317_200074729.png)


每个分层中，都会对所发送的数据附加一个首部，这个首部中包含了该层必要的信息，如发送的目标地址以及协议相关信息。

### 发送数据包
1. 应用程序处理
    应用在发送邮件的那一刻建立TCP连接，从而利用这个TCP连接发送数据。它的过程是首先将应用的数据发送给下一层的TCP，再做实际的转发处理。
2. TCP模块的处理
    TCP根据应用的指示，负责建立连接，发送数据以及断开连接。TCP提供将应用层发来的数据顺利发送至对端的可靠传输。
    为了实现TCP这一功能，需要在应用层数据的前端附加一个TCP首部。TCP首部中包括源端口号和目标端口号，序号（用以发送的包中哪部分是数据），以及校验和（用以判断数据是否被损坏）。随后将附加了TCP首部的包再发送给IP。
3. IP模块的处理
    IP将TCP传过来的包含TCP首部和TCP数据合起来当作自己的数据，并在TCP首部的前端加上自己的IP首部。IP包生成后，参考路由控制表决定接收此IP包的路由或主机。随后，IP包将被发送给连接这些路由器或主机网络接口的驱动程序，以实现真正的数据发送。如果尚不知道接收端的MAC地址，可以利用ARP查找。
4. 网络接口（以太网驱动）的处理
    从IP传过来的IP包，对于以太网驱动来说不过就是数据。以太网驱动给这些数据添加上以太网首部，并进行发送处理。以太网首部中包含接收端的MAC地址，发送端的MAC地址，以及标志以太网类型的以太网数据的协议。
 
![](https://img-vnote-1251075307.cos.ap-beijing.myqcloud.com/1627898614_20210802175307489_1844062748.png)


### 数据包接收处理
包的接收流程是发送流程的逆序过程。

1. 网络接口的处理
    主机收到以太网包后，首先从以太网包首部找到MAC地址，判断是否为发送给自己的包，如果不是则丢弃掉。
    而如果恰好是发送给自己的包，就查找以太网包首部中的类型域，从而确定以太网协议送传送过来的数据类型。
2. IP模块的处理
    IP模块收到IP包首部及后面的数据部分以后，也做类似的处理。如果判断得出包首部的IP地址与自己的IP地址匹配，则可接收数据并从中查找上一层的协议。如果上一层是TCP就将IP包首部之后的部分传给TCP处理。如果是UDP，则传给UDP处理。对于有路由器的情况下，接收端地址往往不是自己的地址，需要借助路由控制表，在调查应该送达的主机或路由器以后再转发数据。
3. TCP模块的处理
    在TCP模块中，首先会计算一下校验和，判断数据是否被破坏。然后检查是否按照序号接收数据。最后检查端口号，确定具体的应用程序。
4. 应用程序的处理
    

