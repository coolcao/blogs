# 状态机

## 状态和转移
所谓状态机，其实就是集合上的二元关系，这个集合中的元素称为“状态”，这个关系，称为转移关系，转移关系图中的箭头表示一次转移。从状态q到状态r的关系写做`q->r`。

例如，0到99的有界计数器是一个简单的状态机，它会在100时溢出，如图：

![](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/mcs/Xnip2020-02-14_22-04-11.png)

上界为99的计数器状态的转移图

其中，圆圈表示状态，箭头表示转移，标注0的双圆圈表示初始状态。

更准确的说，这个有界状态机为：

```
状态      ::= {0,1,...,99,溢出}
初始状态   ::= 0
转移      ::= {n->n+1 | 0≤n<99}∪{99->溢出,溢出->溢出}
```

一旦溢出，状态机就失效了，因为无法摆脱溢出状态。

通常，状态机中的状态数目是有限的。

## 不变性原理
### 沿对角线移动的机器人
设想我们现在有一个无限的二维整数网格，机器人在这个空间内移动。任意时刻机器人的状态就是它所处的二维坐标(x,y)。那么，初始状态为(0,0)，机器人的每一步移动只能是相邻的对角线网格，如下图所示：

![](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/mcs/Xnip2020-02-14_22-11-46.png)

机器人的状态转移表示为：

{(m,n)->(m+1,n+1)|m,n∈Z}

我们观察这个机器人，发现它所能到达的位置(m,n)都满足m+n为偶数。**转移过程中坐标值之和是偶数，这就是保持不变性。**

定义状态的偶数和的性质如下：

Even-sum((m,n))::=[m+n为偶数]

**引理6.2.1: 给定对角线移动的机器人，对任意转移q->r，如果Even-sum(q)，则Even-sum(r)。**

从机器人转移的定义可以直接得出这个引理，即(m,n)->(m±1,n±1).一次转移之后坐标和的增量为(±1)+(±)，即0,2,-2。偶数加上0,2,-2得到的值也一定是偶数。

**定理6.2.2:给定沿对角线移动的机器人，它在任何可达状态下的横纵座标之和都为偶数。**

### 不变性原理的定义

**定义：状态机的执行是指状态机可能具有的状态序列（可能是无限的），满足以下性质：**
- 从初始状态开始，并且
- 若q,r表示序列中两个连续的状态，那么 q->r
- 执行中出现的状态是可达的。


**定义：状态机的保持不变性是指关于状态的谓词P满足：对任意状态q，如果P(q)为真，且存在状态r，其中q->r，那么P(r)也为真。**

```
不变性原理
如果状态机的保持不变性在初始状态为真，则所有可达状态皆为真。
```
