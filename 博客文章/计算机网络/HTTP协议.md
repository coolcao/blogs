---
    title: Http协议
    auther: coolcao,
    date: 2016-07-12 21:09:21
    tags: [HTTP,计算机网络]
---
## 1. 介绍
### 1.1. 简介
* HTTP协议是一个基于请求响应模式的，无状态的，应用层协议。
* HTTP请求由三部分组成，请求行（请求方法+URI），请求头，请求体
* HTTP响应也是由三部分组成：状态行（HTTP协议版本+状态码+状态码描述），响应头，响应体
* HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写。
* HTTP协议是应用层协议，由请求和相应构成，是一个标准的客户端服务器模型。
* HTTP协议是一个无状态的协议
### 1.2. 主要特点
* 支持客户端/服务器模式
* 无链接。无链接的含义是限制每次链接只处理一个请求，服务器处理完客户的请求，并收到客户的应答后，即断开链接。采用这种方式可以节省传输时间。
* 无状态。协议对于事务的处理没有记忆能力。缺少状态以为着，如果后续处理需要前面的信息，则它必须重传，这样可能导致每次链接传送的数据量增大。另一方面，在服务器不需要先前信息时，它的应答就较快。

### 1.3. 请求
请求头中重要参数：
* keep-alive :http请求是基于请求-响应模式的，每次请求都要建立链接。启用keep-alive，吃酒花链接，避免多次重新链接带来的开销。http1.0的时候，默认是keep-alive是关闭的，http1.1默认是开启的。启用keep-alive模式肯定是高校，性能更高，因为避免了建立/释放链接的开销。

### 1.4. 响应
* HTTP响应由三部分组成：状态行（HTTP版本+状态码+状态码描述），响应头，响应体
#### 1.4.1. 状态码
* 1xx:指示信息，表示请求已接收，继续处理。
* 2xx:成功。表示请求已被成功接收，理解，处理
* 3xx:重定向。要完成请求必须进行更进一步的操作。
* 4xx:客户端错误。请求由语法错误或请求无法实现。
* 5xx:服务器端错误。
**常用状态码**
* 200 ok
* 201 created,请求已被实现，而且有一个新的资源已经依据请求的需要而建立，且其URI已经随Location头信息返回。
* 202 accepted,请求已接收，但尚未处理。
* 203 non-authoritative information:服务器已成功处理了请求，但返回的实体头部元信息不是在原始服务器上有效的确定集合，而是来自本地或者第三方的拷贝
* 204 no-content:服务器成功处理了请求，但不需要返回任何实体内容，并且希望返回更新了的元信息。响应可能通过实体头部的形式，返回新的或更新后的元信息。
* 205 reset-content:服务器成功处理了请求，且没有返回任何内容，但是与204不同，返回此状态码的响应要求请求者充值文档视图。该响应主要是用于接收用户输入后，立即重置表单，以便用户能够轻松的开始另一次输入。
* 300 multiple-choices:被请求的资源由一系列可供选择的回馈信息，每个都有自己特定的地址和浏览器驱动的商议信息。用户或浏览器能够自行选择一个首选的地址进行重定向
* 301 moved permanently:被请求的资源已永久移动到新位置，并且将来任何对字资源的引用都应该使用本响应返回的若干哥URI之一。
* 302 move temporarily:请求的资源淋湿从不同的URI响应请求。由于这样的重定向是临时的，客户端应该继续想原有地址发送以后的请求。
* 303 see other:对应当前请求的响应可以在另一个URI上被找到，而且客户端应该采用GET的方式访问哪个资源。
* 304 not modified:已缓存。如果客户端发送了一个带条件的GET请求且该请求已被允许，而文档的内容自上次访问以来或者根据请求的条件并没有改变，则服务器应该返回这个状态码。
* 400 bad request:语义有无，当前请求无法被服务器理解，除非进行改变，否则客户端不应该重复提交这个请求。请求参数有误。
* 401 unauthorized：用户身份认证未通过
* 403 forbidden:服务器已经理解请求，但是拒绝执行它。
* 404 not found:请求失败。请求所希望得到的资源未被在服务器发现。
* 405 method not allowed:请求方法不被允许
* 406 not acceptable:请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。
* 408 request timeout:请求超时
* 500 internal server error:服务器内部错误。
* 502 bad gateway:作为网管或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。
* 503 service unavailable:由于淋湿的服务器未获或者过载，服务器当前无法处理请求，这个状况是临时的。
* 504 gateway timeout:网关或者代理服务器超时

HTTP状态码在rest设计风格中的应用：

* 200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。
* 201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。
* 202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）
* 204 NO CONTENT - [DELETE]：用户删除数据成功。
* 400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。
* 401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。
* 403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。
* 404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。
* 406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。
* 410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。
* 422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。
* 500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。

#### 1.4.2. 幂等
幂等操作的特点是，任意多次执行所产生的影响均与一次执行的影响相同。

#### 1.4.3. 如何判断消息内容/长度的大小
* 根据消息头的content-length字段，标识实体内容的长度，客户端可以根据这个来判断是否接收完成
* 如果没有content-length字段，可以使用Transfer-Encoding:chunk模式来传输数据。基于流，每个chunk分为头部和正文，头部指定正文的字符总数，正文为具体内容。

#### 1.4.4. 服务器端是如何判断返回304状态码的
当客户端第一次请求一个url时，服务器返回的响应头会有一个Last-Modified参数，标识这个文档最后一次更改的时间。

当客户端再次请求这个url时，会将上次服务器返回的这个时间，放到请求头的if-modified-since，服务器接收到后会对比这个时间和当前文档变更的时间是否相同，相同则说明没有变更过，返回304状态码，否则重新返回文档。

## 2. TCP和UDP的区别
### 2.1. TCP Transmission Control Protocol传输控制协议
TCP 协议是面向连接的协议。在收发数据前，必须和对方建立可靠的连接。

三次握手：三次握手的目的是，使数据包的接收和发送同步。

四次挥手：

### 2.2. UDP User Data Protocol用户数据协议
UDP是一个非连接的协议，传输数据之前发送端和接收端不建立连接，当他想传送时就简单的区抓取来自应用程序的数据，并尽可能快的把它扔到网络上。

在接收端，UDP把每个消息段放到队列中，应用程序每次从队列中读一个消息段。

UDP信息包的标题很短，只有8哥字节，相对于TCP的20哥字节信息包的额外开销很小。

### 2.3. 小结TCP和UDP的区别：

* 基于连接与无连接
* 对系统资源的要求（TCP多，UDP少）
* TCP保证数据的正确性，UDP可能丢包，TCP保证数据顺序，UDP不保证。
* UDP程序结构简单
* 流模式与数据报模式
