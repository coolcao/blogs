---
title: 计算机系统漫游
date: 2017-02-04 09:30:02
auther: coolcao
tags: [计算机系统]
---

C语言的编译
-----------

在Unix系统上，从源文件到目标文件的转化是由编译器驱动程序完成的。 如一个简单的hello world的例子：

```c
#include <stdio.h>
int main()
{
    printf("hello,world\n");
}
```

```
unix> gcc -o hello hello.c
```

在这里，，gcc编译器驱动程序读取源文件hello.c，并把他翻译成一个可执行的目标文件hello.如图，执行这四个阶段的程序（预处理器，编译器，汇编器和链接器）一起构成了**编译系统(compilation system)**

![C程序编译流程](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-24%20%E4%B8%8B%E5%8D%883.06.22.png)

-	预处理阶段：预处理器(cpp)根据以字符#开头的命令，修改原始的c程序。比如hello.c中第一行 #include<stdio.h>命令告诉预处理器读取系统文件stdio.h的内容，并把它直接插入到程序文本中。结果就得到了另一个c程序，通常是以.i作为文件拓展名。
-	编译阶段：编译器(ccl)将文本文件hello.i翻译成文本文件hello.s，它包含一个汇编语言程序。
-	汇编器(as)将hello.s翻译成及其语言指令，把这些命令打包成一种叫做 **可重定位目标程序(relocatable object program)** 的格式，并将结果保存在目标文件hello.o中。hello.o是一个二进制文件，它的字节编码是机器语言指令，而不是字符。
-	链接阶段：hello程序调用了printf函数，他是每个c编译器都会提供的标准c库的一个函数，printf函数存在于名为printf.o的单独的预编译好的目标文件中，而这个文件必须以某种方式合并到我们的hello.o程序中。链接器(ld)就是负责这种合并，结果就得到hello文件，它是一个可执行目标文件。可以被加载到内容，由系统执行。
	-	静态链接：在编译阶段直接把静态库加入到可执行文件中去，这样可执行文件会比较大。
	-	动态链接：则是指在链接阶段仅仅加入一些描述信息，而程序执行时，再从系统中把相应的动态库加载到内存。

hello world程序的运行
---------------------

-	初始时，shell程序执行它的指令，等待我们输入一个命令，当我们在键盘上输入'./hello'后，shell将字符逐一读入寄存器，再把它放到存储器中。如图： ![从键盘读取hello命令](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E9%80%89%E5%8C%BA_005.png)
-	当我们在键盘上敲回车键时，shell就知道我们结束了命令的输入。然后shell执行一系列的指令来加载可执行的hello文件，将hello目标文件中的代码和数据从磁盘复制到主存，数据包括最终会被输出的字符串“hello,world\n”

	> 利用直接存储器存取(DMA)的技术，数据可以 不通过处理器而直接从磁盘到达主存，这个步骤如下：
    ![从磁盘加载可执行文件到主存](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E9%80%89%E5%8C%BA_006.png)

-	一旦目标文件hello中的代码和数据被加载到主存，处理器就开始执行hello程序的main程序中的机器语言指令。这些指令将“hello,world\n”字符串中的字节从主存复制到寄存器文件，再从寄存器文件中复制到显示设备，最终显示在屏幕上。如图：

![将输出字符串从内存写到显示器](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E9%80%89%E5%8C%BA_007.png)

系统的硬件组成
--------------

下面一张图是Intel Pentium系统产品系列的模型，但是所有其他系统也有相同的外观和特性。

![系统的硬件组成](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-24%20%E4%B8%8B%E5%8D%883.54.55.png)

-	总线：贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件之间传递。通常总线被设计成传送定长的字节块，也就是**字**。
-	I/O设备：输入/输出设备是系统与外部世界的联系通道。每个I/o设备都通过一个**控制器**或**适配器**与I/o总线相连。控制器与适配器之前的区别主要在于他们的封装方式。控制器是置于I/o设备本身的或者系统的主印制电路板（通常成为主板）上的芯片组，而适配器则是一块插在主板插槽上的卡。他们的功能都是在I/O总线和I/O设备之间传递数据。
-	主存：是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。从物理上说，主存是由一组**动态随机存取存储器(DRAM)**芯片组成的，从逻辑上来说，存储器是一个线性的字节数组，每个字节都有器唯一的地址（即数组索引），这些地址是从零开始的。
-	处理器：是解释或执行存储在主存中指令的引擎。处理器的核心是一个子长的储存设备（寄存器），称为**程序计数器(PC)**。在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）。从系统通电开始，直到系统断电，处理器一直在不断的执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。

高速缓存
--------

一个典型的寄存器文件只存储几百字节的信息，而主存里可存放几十亿字节。然而，处理器中寄存器文件中读数据的速度比从主存中读取几乎要快100倍。针对这种处理器与主存的诧异，系统设计者采用了更小，更快的存储设备，即高速缓存存储器，作为暂时的集结区域，用来存放处理器近期可能会需要的信息。

![高速缓存存储器](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-24%20%E4%B8%8B%E5%8D%884.26.06.png)

存储设备层次结构：
------------------

![存储设备层次结构](https://img001-10042971.cos.ap-shanghai.myqcloud.com/blog/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-24%20%E4%B8%8B%E5%8D%884.27.41.png)

操作系统管理硬件
----------------

操作系统有两个基本功能：1》防止硬件被失控的应用程序滥用。2》向应用程序提供简单一致的机制来控制复杂而又大相径庭的低级硬件设备。
